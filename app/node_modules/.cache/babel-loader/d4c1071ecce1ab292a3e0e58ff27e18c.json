{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/tzach/Downloads/all/Tz Files/project/node-postgres-docker-compose-skeleton-master/app/src/modules/player.jsx\";\nimport React from 'react';\nimport BasicTable from \"./table.jsx\";\nimport animateActions from \"./animate.js\";\nlet cursor;\nimport MenuBar from \"./components/menuBar\";\nimport MusicCard from \"./components/musicCard\";\nimport { db } from \"./components/db.js\";\nconst defaultWidth = 700;\nconst defaultHeight = 400;\n\nclass Player extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.playPlayer = action => {\n      if (!this.state.recordFinishedPlaying) {\n        this.setState({\n          shouldPlayerPause: false\n        });\n        this.play();\n      } else {\n        this.setState({\n          showPlayer: false\n        });\n      }\n    };\n\n    this.pause = action => {\n      this.setState({\n        shouldPlayerPause: true,\n        isPlayingNow: false,\n        recordFinishedPlaying: false\n      });\n    };\n\n    this.handleListClick = action => {\n      this.setState({\n        shouldPlayerPause: true,\n        showPlayer: false,\n        isPlayingNow: false\n      });\n    };\n\n    this.state = {\n      tableHeaders: ['Session Date', 'Duration', 'Play'],\n      tableData: null,\n      showPlayer: false,\n      shouldPlayerPause: false,\n      isPlayingNow: false,\n      recordFinishedPlaying: true,\n      playerScreenWidth: defaultWidth,\n      playerScreenHeight: defaultHeight\n    };\n  }\n\n  componentDidMount() {\n    this.getRecords();\n  }\n\n  async getRecords() {\n    try {\n      const callRes = await fetch('http://localhost:3000/test_db/getRecords', {\n        // const res = await fetch('http://localhost:5000/test_db/saveRecord', {\n        method: 'get',\n        dataType: 'json',\n        contentType: 'application/json; charset=utf-8'\n      });\n      const finalRes = await callRes.json();\n      const failedToGetData = !(finalRes && finalRes.data && finalRes.statusCode === 200);\n\n      if (failedToGetData) {\n        console.error('Failed to get records');\n      }\n\n      const recordsData = finalRes.data.recordsData || [];\n      const tableData = recordsData.map(record => {\n        return {\n          sessionDate: record.sessionDate,\n          duration: record.duration,\n          play: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: this.handlePlayBtnClick.bind(this, record.recordEvents),\n            children: \"Play\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 47,\n            columnNumber: 27\n          }, this)\n        };\n      });\n      this.setState({\n        tableData: tableData || [],\n        recordsData: recordsData || []\n      });\n    } catch (ex) {\n      console.error(ex);\n    }\n  }\n\n  handlePlayBtnClick(steps) {\n    if (this.state.cursor) {\n      cursor = animateActions.hideCursor(this.state.cursor);\n    }\n\n    if (this.state.timeout) {\n      window.clearTimeout(this.state.timeout);\n    }\n\n    this.setState({\n      showPlayer: true,\n      shouldPlayerPause: false\n    }, this.play.bind(this, steps));\n  }\n\n  play(steps) {\n    this.setState({\n      isPlayingNow: true,\n      recordFinishedPlaying: false\n    });\n    this.animate(steps);\n  }\n\n  animate(steps) {\n    let nowTime = this.state.nowTime;\n    let preTime = this.state.preTime;\n    let stepNumber = this.state.stepNumber;\n    let stepsCount = this.state.steps && this.state.steps.length;\n    let timeout = this.state.timeout;\n    let currentStep = this.state.currentStep;\n    let cursor = this.state.cursor;\n    let playerScreenWidth = this.state.playerScreenWidth || defaultWidth;\n    let playerScreenHeight = this.state.playerScreenHeight || defaultHeight;\n\n    if (steps) {\n      nowTime = 0;\n      preTime = 0;\n      stepNumber = 0;\n      stepsCount = steps.length;\n      timeout = null;\n      currentStep = null;\n      cursor = null;\n    }\n\n    steps = steps || this.state.steps;\n    cursor = animateActions.showCursor(cursor);\n    currentStep = steps[stepNumber];\n\n    if (currentStep.screenProportions) {\n      playerScreenWidth = currentStep.screenProportions.width;\n      playerScreenHeight = currentStep.screenProportions.height;\n      this.setState({\n        playerScreenWidth: currentStep.screenProportions.width,\n        playerScreenHeight: currentStep.screenProportions.height\n      });\n\n      if (playerScreenWidth !== this.state.playerScreenWidth || playerScreenHeight !== this.state.playerScreenHeight) {\n        this.updateActionText('Screen Proportion changed to: ' + playerScreenWidth + 'x' + playerScreenHeight);\n      }\n    }\n\n    if (currentStep.type === 'move') {\n      cursor = animateActions.setCursorPosition(currentStep.x, currentStep.y, currentStep.screenProportions, playerScreenWidth, playerScreenHeight, cursor); // this.updateActionText('Mouse move');\n    }\n\n    if (currentStep.type === 'click') {\n      cursor = animateActions.clickOnElementAtPosition(currentStep.x, currentStep.y, currentStep.screenProportions, cursor);\n      this.updateActionText('Mouse click');\n    }\n\n    if (currentStep.type === 'scroll') {\n      window.scrollTo(currentStep.x, currentStep.y);\n      this.updateActionText('Mouse scroll');\n    }\n\n    preTime = nowTime;\n    nowTime = currentStep.time;\n    stepNumber++;\n\n    if (stepNumber === stepsCount) {\n      console.log('Finished playing recording');\n      window.clearTimeout(timeout);\n      cursor = animateActions.hideCursor(cursor);\n      this.clearPlayerData();\n    } else {\n      timeout = setTimeout(() => {\n        if (!this.state.shouldPlayerPause) {\n          this.setState({\n            stepNumber: stepNumber,\n            steps: steps,\n            cursor: cursor,\n            timeout: timeout,\n            stepsCount: stepsCount,\n            currentStep: currentStep,\n            nowTime: nowTime,\n            preTime: preTime\n          });\n          this.animate();\n        }\n      }, preTime - nowTime + 40);\n    }\n  }\n\n  updateActionText(action) {\n    if (action !== this.state.actionText) {\n      this.setState({\n        actionText: action\n      }, () => {\n        setTimeout(() => {\n          this.setState({\n            actionText: ''\n          });\n        }, 500);\n      });\n    }\n  }\n\n  clearPlayerData() {\n    this.setState({\n      stepNumber: 0,\n      steps: [],\n      cursor: null,\n      timeout: null,\n      stepsCount: 0,\n      isPlayingNow: false,\n      showPlayer: false,\n      recordFinishedPlaying: true,\n      playerScreenWidth: defaultWidth,\n      playerScreenHeight: defaultHeight\n    });\n  }\n\n  render() {\n    const content = this.state.showPlayer ? /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: 'grey',\n        width: this.state.playerScreenWidth || defaultWidth,\n        height: this.state.playerScreenHeight || defaultHeight\n      },\n      children: \" \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 49\n    }, this) : /*#__PURE__*/_jsxDEV(BasicTable, {\n      tableHeaders: this.state.tableHeaders || [],\n      tableData: this.state.tableData || [],\n      width: this.state.playerScreenWidth || defaultWidth\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 22\n    }, this);\n    const playerScreenWidth = this.state.playerScreenWidth || defaultWidth;\n    const playerScreenHeight = this.state.playerScreenHeight || defaultHeight;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"playerCanvas\",\n        style: {\n          margin: '50px auto',\n          width: playerScreenWidth\n        },\n        children: [/*#__PURE__*/_jsxDEV(MenuBar, {\n          showPlayer: this.state.showPlayer || false,\n          handleListClick: () => this.handleListClick()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(MusicCard, {\n          data: db.alternative[this.state.current - 1],\n          pause: () => this.pause(),\n          play: () => this.playPlayer(),\n          content: content,\n          isPlayingNow: this.state.isPlayingNow || false,\n          showPlayer: this.state.showPlayer || false,\n          playerScreenHeight: playerScreenHeight,\n          playerScreenWidth: playerScreenWidth,\n          actionText: this.state.actionText || ''\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Player;","map":{"version":3,"sources":["/Users/tzach/Downloads/all/Tz Files/project/node-postgres-docker-compose-skeleton-master/app/src/modules/player.jsx"],"names":["React","BasicTable","animateActions","cursor","MenuBar","MusicCard","db","defaultWidth","defaultHeight","Player","Component","constructor","props","playPlayer","action","state","recordFinishedPlaying","setState","shouldPlayerPause","play","showPlayer","pause","isPlayingNow","handleListClick","tableHeaders","tableData","playerScreenWidth","playerScreenHeight","componentDidMount","getRecords","callRes","fetch","method","dataType","contentType","finalRes","json","failedToGetData","data","statusCode","console","error","recordsData","map","record","sessionDate","duration","handlePlayBtnClick","bind","recordEvents","ex","steps","hideCursor","timeout","window","clearTimeout","animate","nowTime","preTime","stepNumber","stepsCount","length","currentStep","showCursor","screenProportions","width","height","updateActionText","type","setCursorPosition","x","y","clickOnElementAtPosition","scrollTo","time","log","clearPlayerData","setTimeout","actionText","render","content","background","margin","alternative","current"],"mappings":"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","sourcesContent":["import React from 'react';\nimport BasicTable from \"./table.jsx\";\nimport animateActions from \"./animate.js\";\nlet cursor;\nimport MenuBar from \"./components/menuBar\";\nimport MusicCard from \"./components/musicCard\";\nimport { db } from \"./components/db.js\";\nconst defaultWidth = 700;\nconst defaultHeight = 400;\n\nclass Player extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state ={\n            tableHeaders: ['Session Date', 'Duration', 'Play'],\n            tableData: null,\n            showPlayer: false,\n            shouldPlayerPause: false,\n            isPlayingNow: false,\n            recordFinishedPlaying: true,\n            playerScreenWidth: defaultWidth,\n            playerScreenHeight: defaultHeight\n        }\n    }\n    componentDidMount() {\n        this.getRecords();\n    }\n\n    async getRecords() {\n        try {\n            const callRes = await fetch('http://localhost:3000/test_db/getRecords', {\n                // const res = await fetch('http://localhost:5000/test_db/saveRecord', {\n                method: 'get',\n                dataType: 'json',\n                contentType: 'application/json; charset=utf-8'\n            })\n            const finalRes = await callRes.json();\n            const failedToGetData = !(finalRes && finalRes.data && finalRes.statusCode === 200);\n            if (failedToGetData) {\n                console.error('Failed to get records');\n            }\n            const recordsData = finalRes.data.recordsData || [];\n            const tableData = recordsData.map((record) =>{\n                return {\n                    sessionDate: record.sessionDate,\n                    duration: record.duration,\n                    play: <button onClick={this.handlePlayBtnClick.bind(this, record.recordEvents)}>Play</button>\n                }\n            });\n            this.setState({tableData: tableData || [], recordsData: recordsData || []})\n        } catch (ex) {\n            console.error(ex)\n        }\n    }\n\n    handlePlayBtnClick(steps) {\n        if(this.state.cursor){\n            cursor = animateActions.hideCursor(this.state.cursor);\n        }\n        if(this.state.timeout){\n            window.clearTimeout(this.state.timeout);\n        }\n        this.setState({showPlayer: true, shouldPlayerPause: false}, this.play.bind(this, steps))\n    }\n\n    play(steps) {\n        this.setState({isPlayingNow: true, recordFinishedPlaying: false});\n        this.animate(steps)\n    }\n\n    animate(steps) {\n        let nowTime = this.state.nowTime;\n        let preTime = this.state.preTime;\n        let stepNumber = this.state.stepNumber;\n        let stepsCount = this.state.steps && this.state.steps.length;\n        let timeout = this.state.timeout;\n        let currentStep = this.state.currentStep;\n        let cursor = this.state.cursor;\n        let playerScreenWidth = this.state.playerScreenWidth || defaultWidth;\n        let playerScreenHeight = this.state.playerScreenHeight || defaultHeight;\n        if (steps) {\n            nowTime = 0;\n            preTime = 0;\n            stepNumber = 0;\n            stepsCount = steps.length;\n            timeout = null;\n            currentStep = null;\n            cursor = null;\n        }\n        steps = steps || this.state.steps;\n        cursor = animateActions.showCursor(cursor);\n\n        currentStep = steps[stepNumber];\n\n        if (currentStep.screenProportions) {\n            playerScreenWidth = currentStep.screenProportions.width;\n            playerScreenHeight = currentStep.screenProportions.height;\n            this.setState({\n                playerScreenWidth: currentStep.screenProportions.width,\n                playerScreenHeight: currentStep.screenProportions.height\n            })\n\n            if (playerScreenWidth !== this.state.playerScreenWidth || playerScreenHeight !== this.state.playerScreenHeight) {\n                this.updateActionText('Screen Proportion changed to: ' + playerScreenWidth + 'x' + playerScreenHeight);\n            }\n        }\n\n        if (currentStep.type === 'move') {\n            cursor = animateActions.setCursorPosition(currentStep.x, currentStep.y,\n                currentStep.screenProportions, playerScreenWidth, playerScreenHeight, cursor);\n           // this.updateActionText('Mouse move');\n        }\n\n        if (currentStep.type === 'click') {\n            cursor = animateActions.clickOnElementAtPosition(currentStep.x, currentStep.y, currentStep.screenProportions, cursor);\n            this.updateActionText('Mouse click');\n        }\n\n        if (currentStep.type === 'scroll') {\n            window.scrollTo(currentStep.x, currentStep.y);\n            this.updateActionText('Mouse scroll');\n        }\n\n        preTime = nowTime;\n        nowTime = currentStep.time;\n\n        stepNumber++;\n\n        if (stepNumber === stepsCount) {\n            console.log('Finished playing recording');\n            window.clearTimeout(timeout);\n            cursor = animateActions.hideCursor(cursor);\n            this.clearPlayerData();\n        } else {\n\n            timeout = setTimeout(() => {\n                if (!this.state.shouldPlayerPause) {\n                    this.setState({\n                        stepNumber: stepNumber,\n                        steps: steps,\n                        cursor: cursor,\n                        timeout: timeout,\n                        stepsCount: stepsCount,\n                        currentStep: currentStep,\n                        nowTime: nowTime,\n                        preTime: preTime\n                    });\n                    this.animate()\n                }\n            }, preTime - nowTime + 40);\n        }\n    }\n\n\n    updateActionText(action) {\n        if(action !== this.state.actionText){\n            this.setState({actionText: action}, () => {\n                setTimeout(() => {\n                    this.setState({actionText: ''})\n                }, 500);\n            })\n        }\n    }\n\n    clearPlayerData (){\n        this.setState({\n            stepNumber: 0,\n            steps: [],\n            cursor: null,\n            timeout: null,\n            stepsCount: 0,\n            isPlayingNow: false,\n            showPlayer: false,\n            recordFinishedPlaying: true,\n            playerScreenWidth: defaultWidth,\n            playerScreenHeight: defaultHeight\n        });\n    }\n    playPlayer = action => {\n        if(!this.state.recordFinishedPlaying){\n            this.setState({shouldPlayerPause: false});\n            this.play();\n        } else{\n            this.setState({showPlayer: false});\n        }\n    };\n    pause = action => {\n        this.setState({shouldPlayerPause: true, isPlayingNow: false, recordFinishedPlaying: false});\n    };\n    handleListClick = action => {\n        this.setState({shouldPlayerPause: true, showPlayer: false, isPlayingNow: false});\n    };\n\n\n    render() {\n        const content = this.state.showPlayer ? <div style={{\n            background: 'grey',\n            width: this.state.playerScreenWidth || defaultWidth,\n            height: this.state.playerScreenHeight || defaultHeight\n        }}> </div> : <BasicTable\n            tableHeaders={this.state.tableHeaders || []}\n            tableData={this.state.tableData || []}\n            width={this.state.playerScreenWidth || defaultWidth}\n        />\n\n        const playerScreenWidth = this.state.playerScreenWidth || defaultWidth;\n        const playerScreenHeight = this.state.playerScreenHeight || defaultHeight;\n\n        return (\n            <div >\n                <div id={\"playerCanvas\"} style={{margin: '50px auto', width: playerScreenWidth,}}>\n                    <MenuBar showPlayer={this.state.showPlayer || false}\n                    handleListClick={() => this.handleListClick()}/>\n                    <MusicCard\n                        data={db.alternative[this.state.current - 1]}\n                        pause={() => this.pause()}\n                        play={() => this.playPlayer()}\n                        content={content}\n                        isPlayingNow={this.state.isPlayingNow || false}\n                        showPlayer={this.state.showPlayer || false}\n                        playerScreenHeight={playerScreenHeight}\n                        playerScreenWidth={playerScreenWidth}\n                        actionText={this.state.actionText || ''}\n                    />\n                </div>\n            </div>\n        );\n    }\n}\nexport default Player;\n"]},"metadata":{},"sourceType":"module"}